#!/bin/bash
#
# Markdown wrapper for CSS.

CSS=~/.markdown.css
MARKDOWN="markdown --html4tags"

html() {
  cat << EOF
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1, maximuim-scale=1">
${style}
</head>
<body>
$($MARKDOWN "$@")
</body>
</html>
EOF
}

help='false'
embed='false'
files=

for arg; do
  case "${arg}" in
    -e|--embed) embed='true' ;;
    -h|--help) help='true' ;;
    *) files="${files} ${arg}" ;;
  esac
done

if [[ "$help" = 'true' ]]; then
  echo 'usage: buildown [-e|--embed] <file ..>'
  exit 1
fi

if [[ ! -f "$CSS" ]]; then
  echo "warning: $CSS doesn't exist"
fi

if [[ "$embed" = 'true' ]]; then
  style='<style>'"$(cat "$CSS")"'</style>'
else
  style='<link rel="stylesheet" href="'"$CSS"'">'
fi

for file in ${files}; do
  html "${file}"
done
