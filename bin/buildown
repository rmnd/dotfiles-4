#!/bin/bash
#
# Wrapper for Markdown and CSS.

css=~/.markdown.css
markdown="markdown --html4tags"

embed=false
browser=false
help=false
files=

for arg; do
  case "$arg" in
    -e|--embed) embed=true ;;
    -b|--browser) browser=true ;;
    -h|--help) help=true ;;
    *) files="${files} ${arg}" ;;
  esac
done

if "$help" || [[ $# -eq 0 ]]; then
  echo 'usage: buildown [-e|--embed] [-b|--browser] <file ..>'
  exit 1
fi

if "$embed"; then
  style="<style>$(cat "$css")</style>"
else
  style="<link rel=\"stylesheet\" href=\"${css}\">"
fi

for file in $files; do
  html="<!DOCTYPE html>
<html>
<head>
<meta charset=\"utf-8\">
<meta name=\"viewport\" content=\"initial-scale=1, maximuim-scale=1\">
${style}
</head>
<body>
$($markdown "$file")
</body>
</html>"

  if "$browser"; then
    out="${file}.html"
    echo "$html" > "$out"
    $BROWSER "$out" && rm "$out"
  else
    echo "$html"
  fi
done
